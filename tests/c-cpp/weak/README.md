Tests contributed by Martin Storsjo.
