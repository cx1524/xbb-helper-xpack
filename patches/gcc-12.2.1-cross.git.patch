From 37ed9533800ccfe562c93c86fe3e77ea4b459396 Mon Sep 17 00:00:00 2001
From: Liviu Ionescu <ilg@livius.net>
Date: Thu, 28 Apr 2022 19:22:18 +0300
Subject: [PATCH] Try to add support for Apple Silicon

# Conflicts:
#	gcc/config/aarch64/x-darwin
---
 gcc/config/aarch64/host-aarch64-darwin.c | 33 ++++++++++++++++++++++++
 gcc/config/aarch64/x-darwin              |  4 +--
 2 files changed, 35 insertions(+), 2 deletions(-)
 create mode 100644 gcc/config/aarch64/host-aarch64-darwin.c

diff --git a/gcc/config/aarch64/host-aarch64-darwin.c b/gcc/config/aarch64/host-aarch64-darwin.c
new file mode 100644
index 00000000000..d70f2df3bf1
--- /dev/null
+++ b/gcc/config/aarch64/host-aarch64-darwin.c
@@ -0,0 +1,33 @@
+/* aarch64/arm64-darwin host-specific hook definitions.
+
+Copyright The GNU Toolchain Authors.
+
+This file is part of GCC.
+
+GCC is free software; you can redistribute it and/or modify it under
+the terms of the GNU General Public License as published by the Free
+Software Foundation; either version 3, or (at your option) any later
+version.
+
+GCC is distributed in the hope that it will be useful, but WITHOUT ANY
+WARRANTY; without even the implied warranty of MERCHANTABILITY or
+FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+for more details.
+
+You should have received a copy of the GNU General Public License
+along with GCC; see the file COPYING3.  If not see
+<http://www.gnu.org/licenses/>.  */
+
+#define IN_TARGET_CODE 1
+
+#include "config.h"
+#include "system.h"
+#include "coretypes.h"
+#include "hosthooks.h"
+#include "hosthooks-def.h"
+#include "config/host-darwin.h"
+
+/* Darwin doesn't do anything special for arm64/aarch64 hosts; this file
+   exists just to include the generic config/host-darwin.h.  */
+
+const struct host_hooks host_hooks = HOST_HOOKS_INITIALIZER;
diff --git a/gcc/config/aarch64/x-darwin b/gcc/config/aarch64/x-darwin
index 1e0bad2648a..132daf6fc37 100644
--- a/gcc/config/aarch64/x-darwin
+++ b/gcc/config/aarch64/x-darwin
@@ -1,3 +1,3 @@
-host-aarch64-darwin.o : $(srcdir)/config/aarch64/host-aarch64-darwin.cc
-	$(COMPILE) $<
+host-aarch64-darwin.o: $(srcdir)/config/aarch64/host-aarch64-darwin.c
+	$(COMPILER) -c $(ALL_COMPILERFLAGS) $(ALL_CPPFLAGS) $(INCLUDES) $<
 	$(POSTCOMPILE)
-- 
2.37.1 (Apple Git-137.1)

