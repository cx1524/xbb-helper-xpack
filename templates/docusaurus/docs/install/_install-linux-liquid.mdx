
import CodeBlock from '@theme/CodeBlock';

import customField from '@site/src/libs/customField';

import AutomatedInstall from './_common/_automated-install.mdx';
import AutomatedUninstall from './_common/_automated-uninstall.mdx';
import ManualInstall from './_common/_manual-install.mdx';
import ManualInstallInfo from './_common/_manual-info.mdx';
import ManualInstallLinux from './_common/_manual-install-linux.mdx'

{/* ------------------------------------------------------------------------ */}

<AutomatedInstall label={ props.label }/>

<details>
<summary>PATH</summary>

In order to access the {{ appName }} binaries installed in
the central xPacks store,
the project build configurations need a PATH adjustment:

<CodeBlock language="sh"> {
`export PATH=$HOME/.local/xPacks/@xpack-dev-tools/{{ appLcName }}/${ customField('upstreamVersion') }-${ customField('xpackSubversion') }.${ customField('npmSubversion') }/.content/bin:$PATH`
} </CodeBlock>
</details>

<details>
<summary>Folder hierarchy</summary>

After install, the package creates a folder hierarchy like the following
(only the first two depth levels are shown):

<CodeBlock language="console"> {
`$ tree -L 2 ~/.local/xPacks/\@xpack-dev-tools/{{ appLcName }}/${ customField('upstreamVersion') }-${ customField('xpackSubversion') }.${ customField('npmSubversion') }/.content/
/home/ilg/.local/xPacks/\@xpack-dev-tools/{{ appLcName }}/${ customField('upstreamVersion') }-${ customField('xpackSubversion') }.${ customField('npmSubversion') }/.content/
├── README.md
├── bin
│   └── {{ appLcName }}
├── distro-info
│   └── licenses
├── libexec
│   ├── libftdi1.so.2 -> libftdi1.so.2.5.0
│   ├── libftdi1.so.2.5.0
│   ├── libhidapi-hidraw.so.0 -> libhidapi-hidraw.so.0.14.0
│   ├── libhidapi-hidraw.so.0.14.0
│   ├── libudev.so.1 -> libudev.so.1.6.9
│   ├── libudev.so.1.6.9
│   ├── libusb-1.0.so.0 -> libusb-1.0.so.0.4.0
│   └── libusb-1.0.so.0.4.0
└── {{ appLcName }}
    ├── OpenULINK
    ├── angie
    ├── contrib
    └── scripts

9 directories, 10 files`
} </CodeBlock>

No other files are installed in any system folders or other locations.

</details>

<AutomatedUninstall/>

### Quick test

To check if the {{ appName }} installed by **xpm** starts properly, use something like:

<CodeBlock language="console"> {
`$ ~/.local/xPacks/@xpack-dev-tools/{{ appLcName }}/${ customField('upstreamVersion') }-${ customField('xpackSubversion') }.${ customField('npmSubversion') }/.content/bin/{{ appLcName }} --version
${ customField('upstreamVersion') }`
} </CodeBlock>

<ManualInstall/>

<ManualInstallLinux/>

<ManualInstallInfo/>

<details>
<summary>PATH</summary>

With all binary tools installed in `xpacks/.bin`, the project build
configurations need a single PATH adjustment:

```sh
export PATH=<...project-path...>/xpacks/.bin:$PATH
```

:::tip

On Windows, when not using the Git console, adjust the syntax for the
corresponding shell.

:::
</details>

### Quick test

To check if the {{ appName }} installed manually starts properly, use something like:

<CodeBlock language="console"> {
`$ ~/.local/xPacks/{{ appLcName }}/xpack-{{ appLcName }}-${ customField('upstreamVersion') }-${ customField('xpackSubversion') }/bin/{{ appLcName }} --version
${ customField('upstreamVersion') }`
} </CodeBlock>

## Drivers

### UDEV

For the JTAG probes implemented as USB devices (actually most of them),
the last installation step on GNU/Linux is to configure the **UDEV**
subsystem. {{ appName }} provides an UDEV rules file defining all the
supported IDs; to install it, just copy the file to `/etc/udev/rules.d`
and eventually notify the daemon:

<CodeBlock language="sh"> {
`sudo cp ~/.local/xPacks/@xpack-dev-tools/{{ appLcName }}/${ customField('upstreamVersion') }-${ customField('xpackSubversion') }.${ customField('npmSubversion') }/.content/contrib/60-{{ appLcName }}.rules /etc/udev/rules.d/`
} </CodeBlock>

To make the change effective, reload the rules:

```sh
sudo udevadm control --reload-rules
```

:::tip

If you previously installed the
J-Link binaries, the USB IDs were
already added to UDEV. The above {{ appName }} rules file also defines the
J-Link ID. Apparently UDEV does not complain; if you encounter
problems, just comment out the definition in the {{ appName }} file.

:::

### USB access rights

On some GNU/Linux distributions, the UDEV definitions are not enough,
or are not effective, and when trying to access the JTAG probe,
an error is issued:

```console
libusb_open failed: LIBUSB_ERROR_ACCESS
```

If this happens, first try to start {{ appLcName }} with `sudo`; if this works,
for regular work you also need to grant your user permission to use the USB.

For example, on Ubuntu you need to issue something like:

```sh
sudo usermod -aG plugdev $USER
```

Then restart and login again.

If you still have problems, check your distribution documentation and
when you have a functional solution post it on the project
[GitHub Discussions](https://github.com/xpack-dev-tools/{{ appLcName }}-xpack/discussions/).
